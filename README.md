üê£ Please follow me for new updates https://twitter.com/camenduru <br />
üî• Please join our discord server https://discord.gg/k5BwmmvJJU <br />
ü•≥ Please join my patreon community https://patreon.com/camenduru <br />

## Motivation

### A non-profit GPU cluster that runs open-source paper demos with a UI for free for everyone.

https://twitter.com/camenduru/status/1747802652182737050
![image](https://github.com/camenduru/community-gpu-cluster/assets/54370274/99285477-fb17-44e6-ba5f-fce56902dde0)

- If each person receives 24 hours of compute time every week with a 3090 or A5000 GPU 7 people can use it, with 2xGPU 14 people, with 24xGPU 168 people ...
- Operation cost (electricity): 2xGPU 3090 or A5000 24 Hours ~$2
- End-of-the-year goal: 6 servers with a total of 24 x A5000 or 3090 GPUs.


## First Server Parts

- ‚úî GPU1: Asus ROG Strix RTX3090 O24G (default 3-slot with Liquid Cooler 2-slot) $747
- ‚úî GPU2: Asus ROG Strix RTX3090 O24G-W (default 3-slot with Liquid Cooler 2-slot) $790
- ‚úî 3 x Case Fan: NZXT AER P - RF-AP140-FP $26
- ‚úî Motherboard: Asus Pro WS C621-64L SAGE (4 GPU Support) $628
- ‚úî CPU: Intel¬Æ Xeon¬Æ W-3235 Processor (64 Lane PCIe 3.0) (4 GPU Support) $197
- ‚úî CPU Cooler: 4U Active CPU Heat Sink LGA3647 (Narrow) $78
- ‚úî Ram: 1 x 32GB Micron 32GB DDR4-3200 ECC-RDIMM 1Rx4 CL22 $95
- ‚úî Ram: 1 x 32GB Micron 32GB DDR4-3200 ECC-RDIMM 1Rx4 CL22 $95
- ‚úî SSD: Lexar NM790 4TB M.2 NVMe PCIe Gen 4X4 7400-6500 MB/s $271
- ‚úî Power supply: Corsair AX1500i 1500 Watt 80+ Titanium $249
- ‚úî Case: Antec P20C-W (E-ATX) $89

## Second Server Parts

- ‚úî GPU1: Asus ROG Strix RTX3090 O24G (default 3-slot with Liquid Cooler 2-slot) $745
- GPU2: 3090 OR A5000
- ‚úî 3 x Case Fan: NZXT AER P - RF-AP140-FP $26
- ‚úî Motherboard: Asus Pro WS C621-64L SAGE (4 GPU Support) $634
- ‚úî CPU: Intel¬Æ Xeon¬Æ W-3235 Processor (64 Lane PCIe 3.0) (4 GPU Support) $190
- ‚úî CPU Cooler: 4U Active CPU Heat Sink LGA3647 (Narrow) $63
- ‚úî Ram: 1 x 32GB Micron 32GB DDR4-3200 ECC-RDIMM 1Rx4 CL22 $107
- ‚úî Ram: 1 x 32GB Micron 32GB DDR4-3200 ECC-RDIMM 1Rx4 CL22 $107
- ‚úî SSD: Patriot Viper VP4300 Lite 4TB Gen 4x4 7400-6000 MB/s $262
- ‚úî Power supply: Corsair AX1500i 1500 Watt 80+ Titanium $227
- ‚úî Case: Antec P20C-W (E-ATX) $89

## Budget & Sponsors
- May Sponsor [@0xKyon](https://x.com/0xKyon) | https://x.com/camenduru/status/1786356739979313312 ![image](https://github.com/camenduru/non-profit-gpu-cluster/assets/54370274/9359db9d-9ba8-46ca-9ce8-f63b7652eaf8)
- April Sponsor [@0xKyon](https://x.com/0xKyon) | https://x.com/camenduru/status/1777537399343513978 ![image](https://github.com/camenduru/non-profit-gpu-cluster/assets/54370274/8507cd89-1764-4c5d-a8ee-2e3c8c0509d1)
- March Sponsor [@adhik_Joshi](https://twitter.com/adhik_Joshi) | https://x.com/camenduru/status/1768848878017675430 ![image](https://github.com/camenduru/non-profit-gpu-cluster/assets/54370274/0fcbb257-f756-4471-b12e-2b32736a8ffa)
- February Sponsor [@replicate](https://x.com/replicate) | https://x.com/camenduru/status/1753460739954630776 ![image](https://github.com/camenduru/non-profit-gpu-cluster/assets/54370274/31d045a5-3f43-4c65-bf2d-860a93171b80)
- [artizen.fund](https://artizen.fund) [@RJPinnell](https://twitter.com/RJPinnell) [@ArtizenFund](https://twitter.com/ArtizenFund) | https://twitter.com/camenduru/status/1760205819839144182 ![image](https://github.com/camenduru/non-profit-gpu-cluster/assets/54370274/13242948-2bcf-465d-81b0-4c0a3becf5a5)
- [fictions.ai](https://fictions.ai/) [@thibaudz](https://twitter.com/thibaudz) | https://twitter.com/camenduru/status/1749788882877448451
![image](https://github.com/camenduru/non-profit-gpu-cluster/assets/54370274/41756396-6289-4795-bd06-b1f234bf5d73)
- Chai Prize Grant [@chai_research](https://twitter.com/chai_research) | https://twitter.com/chai_research/status/1702811327323070762
![image](https://github.com/camenduru/community-gpu-cluster/assets/54370274/ecef1797-2d8a-42f1-b8f5-d336a9dc3df3)
- January Sponsor [@adhik_Joshi](https://twitter.com/adhik_Joshi) | https://twitter.com/camenduru/status/1744371512981794865
![image](https://github.com/camenduru/community-gpu-cluster/assets/54370274/4c1aa14c-e8ad-461d-a458-d37f78ad4d2e)
- December Sponsor [@adhik_Joshi](https://twitter.com/adhik_Joshi) | https://twitter.com/camenduru/status/1729995264096641233
![image](https://github.com/camenduru/community-gpu-cluster/assets/54370274/6e41805b-01ff-40bb-9dfe-38dd2ac7e572)

- [First Server] Total: $3265
- https://tost.ai 2 Years Registration $138
- [Second Server] Total (Optimistic Prediction): $3163
- For the second server, we still need $820 üòê

## Updates

### June 12, 2024
‚úî Ram: 1 x 32GB Micron 32GB DDR4-3200 ECC-RDIMM 1Rx4 CL22 $107 <br />

### June 6, 2024
‚úî CPU Cooler: 4U Active CPU Heat Sink LGA3647 (Narrow) $63 <br />
‚úî Ram: 1 x 32GB Micron 32GB DDR4-3200 ECC-RDIMM 1Rx4 CL22 $107 <br />
‚úî SSD: Patriot Viper VP4300 Lite 4TB Gen 4x4 7400-6000 MB/s $262 <br />

### May 22, 2024
‚úî 3 x Case Fan: NZXT AER P - RF-AP140-FP $26 <br />
‚úî 3 x Case Fan: NZXT AER P - RF-AP140-FP $26 <br />
‚úî GPU1: Asus ROG Strix RTX3090 O24G (default 3-slot with Liquid Cooler 2-slot) $745 <br />

### May 20, 2024
‚úî CPU: Intel¬Æ Xeon¬Æ W-3235 Processor (64 Lane PCIe 3.0) (4 GPU Support) $190 <br />

### May 17, 2024
‚úî Motherboard2: Asus Pro WS C621-64L SAGE (4 GPU Support) $634 <br />

### January 31, 2024
‚úî CPU1: Intel¬Æ Xeon¬Æ W-3235 Processor (64 Lane PCIe 3.0) (4 GPU Support) $197 <br />
‚úî CPU2: Intel¬Æ Xeon¬Æ Silver 4110 Processor (48 Lane PCIe 3.0) (3 GPU Support) $33 <br />
‚úî RAM1: 1 x 32GB (Micron 32GB DDR4-3200 ECC-RDIMM 1Rx4 CL22) $95 <br />
‚úî SSD1: Lexar NM790 4TB M.2 NVMe PCIe Gen 4X4 7400-6500 MB/s $271 <br />

### January 27, 2024
‚úî Power Supply2: Corsair AX1500i 1500 Watt 80+ Titanium $227 <br />
‚úî Case2: (Antec P20C-W) $89 <br />

### January 24, 2024
‚úî GPU2: Asus ROG Strix RTX3090 O24G-W (default 3-slot with Liquid Cooler 2-slot) $790 <br />

### January 23, 2024
‚úî üßø The non-profit GPU cluster is now running [instantid.github.io](https://instantid.github.io/) ü•≥ (operating with an old motherboard and CPU because our new CPU has not arrived yet)

### January 22, 2024
‚úî üßø The non-profit GPU cluster is now running [photo-maker.github.io](https://photo-maker.github.io/) ü•≥ (operating with an old motherboard and CPU because our new CPU has not arrived yet)

### January 20 2024
‚úî GPU1: Asus ROG Strix RTX3090 O24G (default 3-slot with Liquid Cooler 2-slot) $747 <br />
‚úî Power Supply1: Corsair AX1500i 1500 Watt 80+ Titanium $249 <br />
‚úî CPU Cooler1: 4U Active CPU Heat Sink LGA3647 (Narrow) $78 <br />

### January 19 2024
‚úî Motherboard1: (Asus Pro WS C621-64L SAGE) $628 <br />
‚úî RAM1: 1 x 32GB (Micron 32GB DDR4-3200 ECC-RDIMM 1Rx4 CL22) $95 <br />
‚úî Case1: (Antec P20C-W) $89 <br />
![mb_one_ram_case](https://github.com/camenduru/Community-GPU-Cluster/assets/54370274/805fdf46-4fee-46d3-a41b-b827d959e860)

## Setup

### SSH root login
```shell
sudo nano /etc/ssh/sshd_config
PermitRootLogin prohibit-password to PermitRootLogin yes
sudo systemctl restart ssh
sudo passwd
sudo ufw allow ssh
```

### Ubuntu 22.04.3 LTS
```shell
apt update
apt upgrade -y
apt install build-essential software-properties-common zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libreadline-dev libffi-dev -y
apt install wget nvtop python-is-python3 python3-pip aria2 unrar -y
```

### Cuda 12.1.0_530.30.02
```shell
lsmod | grep nouveau
cat <<EOF | sudo tee /etc/modprobe.d/blacklist-nouveau.conf
blacklist nouveau
options nouveau modeset=0
EOF
sudo update-initramfs -u
sudo reboot

wget https://developer.download.nvidia.com/compute/cuda/12.1.0/local_installers/cuda_12.1.0_530.30.02_linux.run
sh cuda_12.1.0_530.30.02_linux.run
nvidia-smi
nano /etc/ld.so.conf
ldconfig

nano .bashrc
ldconfig
nvcc --version

nvidia-smi -q | grep -i bar -A 3
https://www.nvidia.com/en-us/geforce/news/geforce-rtx-30-series-resizable-bar-support/
https://forums.developer.nvidia.com/t/enabling-resizable-bar-on-rtx-30-series-gpus-in-linux/239950
```

### Python 3.10.12
```shell
pip install torch==2.3.0+cu121 torchvision==0.18.0+cu121 torchaudio==2.3.0+cu121 torchtext==0.18.0 torchdata==0.7.1 --extra-index-url https://download.pytorch.org/whl/cu121
pip install xformers==0.0.26.post1
pip install torch==2.2.1+cu121 torchvision==0.17.1+cu121 torchaudio==2.2.1+cu121 torchtext==0.17.1 torchdata==0.7.1 --extra-index-url https://download.pytorch.org/whl/cu121
pip install xformers==0.0.25
pip install torch==2.1.0+cu121 torchvision==0.16.0+cu121 torchaudio==2.1.0+cu121 torchtext==0.16.0 torchdata==0.7.0 --extra-index-url https://download.pytorch.org/whl/cu121
pip install notebook
pip show torch notebook
```

### Network
```shell
nano /etc/netplan/00-installer-config.yaml
netplan apply

wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
dpkg -i cloudflared-linux-amd64.deb
cloudflared service install TOKEN_HERE
```

### Docker
```shell
https://docs.docker.com/engine/install/ubuntu/
https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#installing-the-nvidia-container-toolkit
systemctl restart docker
https://github.com/jupyter/docker-stacks

https://github.com/camenduru/docker-stacks-foundation
https://github.com/camenduru/base-notebook
https://quay.io/repository/camenduru/docker-stacks-foundation
https://quay.io/repository/camenduru/base-notebook
docker build -t base-notebook .

Ubuntu 22.04 Python 3.10.11
timeout 4h docker container run -it --rm --gpus all -u root -e GRANT_SUDO=yes -p 1000:7860 quay.io/camenduru/base-notebook:latest
timeout 4h docker container run -it --rm --gpus device=0 -u root -e GRANT_SUDO=yes -p 1000:7860 registry.hf.space/camenduru-base-notebook:latest
timeout 4h docker container run -it --rm --gpus device=1 -u root -e GRANT_SUDO=yes -p 1000:7860 camenduru/base-notebook:latest
docker system prune -a

docker cp /content/test.rar 76e35c4a6e8f:/home/jovyan/test.rar
docker exec -it 76e35c4a6e8f bash
```

### Other
```shell
tmux ls
tmux a
tmux attach-session -t 0
tmux capture-pane -pS - > ~/tmux-buffer.txt

wget https://openrgb.org/releases/release_0.9/openrgb_0.9_amd64_bookworm_b5f46e3.deb
dpkg -i openrgb_0.9_amd64_bookworm_b5f46e3.deb
apt --fix-broken install
openrgb -m off

find / -type f -exec du -h {} + | sort -rh | head -n 20

git clone https://github.com/aristocratos/btop
cd btop
make
make install PREFIX=/usr

https://github.com/raboof/nethogs
```

## Services

### Jupyter
```shell
https://github.com/jupyterlab/jupyterlab

mkdir /content
nano /etc/systemd/system/jupyter-lab.service
systemctl daemon-reload
systemctl start jupyter-lab
systemctl enable jupyter-lab
systemctl list-unit-files --type=service --state=enabled
pip install pickleshare ipywidgets
```

### OpenVSCode
```shell
https://github.com/coder/code-server

curl -fsSL https://code-server.dev/install.sh | sh
nano /etc/systemd/system/default.target.wants/code-server@root.service
systemctl enable --now code-server@$USER
systemctl status code-server@$USER
systemctl enable code-server@$USER
systemctl list-unit-files --type=service --state=enabled

nano /root/.config/code-server/config.yaml
bind-addr: 0.0.0.0:8080
auth: none
disable-telemetry: true
cert: false

chrome://flags/#unsafely-treat-insecure-origin-as-secure
```

### Stable Diffusion WebUI
```shell
https://github.com/AUTOMATIC1111/stable-diffusion-webui

pip install virtualenv
cd /content
virtualenv stable-diffusion-webui-venv
. /content/stable-diffusion-webui-venv/bin/activate
deactivate

mkdir /content
nano /etc/systemd/system/stable-diffusion-webui.service
systemctl daemon-reload
systemctl start stable-diffusion-webui
systemctl stop stable-diffusion-webui
systemctl enable stable-diffusion-webui
systemctl disable stable-diffusion-webui
systemctl list-unit-files --type=service --state=enabled
```

### Stable Cascade
```shell
https://github.com/Stability-AI/StableCascade

pip install virtualenv
cd /content
virtualenv stable-cascade-venv
. /content/stable-cascade-venv/bin/activate
deactivate

mkdir /content
nano /etc/systemd/system/stable-cascade.service
systemctl daemon-reload
systemctl start stable-cascade
systemctl stop stable-cascade
systemctl enable stable-cascade
systemctl disable stable-cascade
systemctl list-unit-files --type=service --state=enabled
```

### Instant ID
```shell
https://github.com/InstantID/InstantID

pip install virtualenv
cd /content
virtualenv instant-id-venv
. /content/instant-id-venv/bin/activate
deactivate

mkdir /content
nano /etc/systemd/system/instant-id.service
systemctl daemon-reload
systemctl start instant-id
systemctl stop instant-id
systemctl enable instant-id
systemctl disable instant-id
systemctl list-unit-files --type=service --state=enabled
```

### Forge
```shell
https://github.com/lllyasviel/stable-diffusion-webui-forge

pip install virtualenv
cd /content
virtualenv forge-venv
. /content/forge-venv/bin/activate
deactivate

mkdir /content
nano /etc/systemd/system/forge.service
systemctl daemon-reload
systemctl start forge
systemctl stop forge
systemctl enable forge
systemctl disable forge
systemctl list-unit-files --type=service --state=enabled
```

### Dust3r
```shell
https://github.com/naver/dust3r

pip install virtualenv
cd /content
virtualenv dust3r-venv
. /content/dust3r-venv/bin/activate
deactivate

mkdir /content
nano /etc/systemd/system/dust3r.service
systemctl daemon-reload
systemctl start dust3r
systemctl stop dust3r
systemctl enable dust3r
systemctl disable dust3r
systemctl list-unit-files --type=service --state=enabled
```

### TripoSR
```shell
https://github.com/VAST-AI-Research/TripoSR

pip install virtualenv
cd /content
virtualenv TripoSR-venv
. /content/TripoSR-venv/bin/activate
deactivate

mkdir /content
nano /etc/systemd/system/triposr.service
systemctl daemon-reload
systemctl start triposr
systemctl stop triposr
systemctl enable triposr
systemctl disable triposr
systemctl list-unit-files --type=service --state=enabled
```

### CRM
```shell
https://github.com/thu-ml/CRM

pip install virtualenv
cd /content
virtualenv crm-venv
. /content/crm-venv/bin/activate
deactivate

mkdir /content
nano /etc/systemd/system/crm.service
systemctl daemon-reload
systemctl start crm
systemctl stop crm
systemctl enable crm
systemctl disable crm
systemctl list-unit-files --type=service --state=enabled
```

### VisualStylePrompting
```shell
https://github.com/naver-ai/Visual-Style-Prompting

pip install virtualenv
cd /content
virtualenv VisualStylePrompting-venv
. /content/VisualStylePrompting-venv/bin/activate
deactivate

mkdir /content
nano /etc/systemd/system/VisualStylePrompting.service
systemctl daemon-reload
systemctl start VisualStylePrompting
systemctl stop VisualStylePrompting
systemctl enable VisualStylePrompting
systemctl disable VisualStylePrompting
systemctl list-unit-files --type=service --state=enabled
```

### Web
```shell
apt install openjdk-21-jdk

https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-ubuntu/

curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" 

nvm install 18.20.3
```

### FFmpeg
```shell
https://docs.nvidia.com/video-technologies/index.html

!mkdir /content/ffmpeg
%cd /content/ffmpeg
!git clone https://git.videolan.org/git/ffmpeg/nv-codec-headers.git
%cd nv-codec-headers
!sudo make install
%cd /content/ffmpeg
!git clone https://git.ffmpeg.org/ffmpeg.git /content/ffmpeg/ffmpeg
%cd /content/ffmpeg/ffmpeg
!sudo apt-get install build-essential yasm cmake libtool libc6 libc6-dev unzip wget libnuma1 libnuma-dev pkg-config -y
!./configure --enable-nonfree --enable-cuda-nvcc --enable-nvenc --enable-libnpp --extra-cflags=-I/usr/local/cuda/include --extra-ldflags=-L/usr/local/cuda/lib64 --disable-static --enable-shared
!make -j 24
!make install
```